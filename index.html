<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<title>手机版示例</title>
	<style>
		body {
				font-family: Monospace;
				background-color: #000;
				color: #fff;
				margin: 0px;
				overflow: hidden;
			}
			#layer{
				visibility: hidden;
				padding:150px 100px;
				width: 100px;
				background: rgba(255,255,255,.7);
				border: 1px solid white;
				position: absolute;
				left: 50%;
				margin-left: -150px;
				top: 100px;
				text-align: center;
				border-radius: 5px;
			}
			#close{
				position: absolute;
				padding: 5px 20px;
				border-radius: 5px;
				right: 0;
				top: -40px;
				text-align:center;
				background: rgba(255,255,255,.7);
			}
			#tip{
				position: absolute;
				width: 100%;
				text-align: center;
			}
	</style>
</head>
<script src="zepto.js"></script>
<script src="tween.min.js"></script>
<!--three.js库文件-->
<script src="three.min.js"></script>
<!--用于加载mtl格式的材质库文件-->
<script src="loaders/MTLLoader.js"></script>
<!--用于加载obj格式的模型网格文件-->
<script src="loaders/OBJLoader.js"></script>
<body>
    <p id="tip">下滑切换</p>
	<div id="layer">
		<p id="content">这是一个弹窗示例</p>
		<div id="close">关闭</div>
	</div>
</body>
<script>
	var container;

	var camera, scene, raycaster, renderer;
	var mouse = new THREE.Vector2(), INTERSECTED;
	mouse.x = -9999;
	mouse.y = -9999;
	var Objs = [];
	var objPositions = [- 700, - 1000, -1300, -1600];
	var layer = document.getElementById('layer');
	var content =  document.getElementById('content');
	var close =  document.getElementById('close');
	var St = +(new Date());

	var windowHalfX = window.innerWidth / 2;
	var windowHalfY = window.innerHeight / 2;

	init();
	animate();

	function init() {

		container = document.createElement( 'div' );
		document.body.appendChild( container );

		camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 1000 );
		camera.position.z = 0;

		// scene

		scene = new THREE.Scene();
		raycaster = new THREE.Raycaster();

		// var ambient = new THREE.AmbientLight( 0x000000 );
		// scene.add( ambient );

		var directionalLight = new THREE.DirectionalLight( 0xffffff );
		directionalLight.position.set( 0, 0, 1 ).normalize();
		scene.add( directionalLight );

		// model

		var onProgress = function ( xhr ) {
			if ( xhr.lengthComputable ) {
				var percentComplete = xhr.loaded / xhr.total * 100;
				console.log( Math.round(percentComplete, 2) + '% downloaded' );
			}
		};

		var onError = function ( xhr ) { 
			alert('模型加载失败，请刷新页面重新加载');
		};
		function setObjPositions(){	
			Objs.forEach(function(o,i){
				o.position.z = objPositions[i];
			});
		}
		var mtlLoader = new THREE.MTLLoader();
		mtlLoader.setPath( 'obj/' );
		mtlLoader.load( '蓝色球.mtl', function( materials ) {
			materials.preload();
			var objLoader = new THREE.OBJLoader();
			objLoader.setMaterials( materials );
			objLoader.setPath( 'obj/' );
			objLoader.load( '蓝色球.obj', function ( object ) {
				Objs.push(object);
				scene.add( object );
				if(Objs.length === 4){
					setObjPositions();
				}
			}, onProgress, onError );
		});
		mtlLoader.load( '裂缝星球.mtl', function( materials ) {
			materials.preload();
			var objLoader = new THREE.OBJLoader();
			objLoader.setMaterials( materials );
			objLoader.setPath( 'obj/' );
			objLoader.load( '裂缝星球.obj', function ( object ) {
				Objs.push(object);
				scene.add( object );
				if(Objs.length === 4){
					setObjPositions();
				}
			}, onProgress, onError );
		});
		mtlLoader.load( '小转星球.mtl', function( materials ) {
			materials.preload();
			var objLoader = new THREE.OBJLoader();
			objLoader.setMaterials( materials );
			objLoader.setPath( 'obj/' );
			objLoader.load( '小转星球.obj', function ( object ) {
				Objs.push(object);
				scene.add( object );
				if(Objs.length === 4){
					setObjPositions();
				}
			}, onProgress, onError );
		});
		mtlLoader.load( '小刺.mtl', function( materials ) {
			materials.preload();
			var objLoader = new THREE.OBJLoader();
			objLoader.setMaterials( materials );
			objLoader.setPath( 'obj/' );
			objLoader.load( '小刺.obj', function ( object ) {
				Objs.push(object);
				scene.add( object );
				if(Objs.length === 4){
					setObjPositions();
				}
			}, onProgress, onError );
		});

		document.ontouchmove = function(ev){ev.preventDefault()}
		$('body').on('swipeDown', function(){
			
		});
		renderer = new THREE.WebGLRenderer({antialias:true});
		renderer.setPixelRatio( window.devicePixelRatio );
		renderer.setSize( window.innerWidth, window.innerHeight );
		container.appendChild( renderer.domElement );

		document.addEventListener( 'mousedown', onDocumentMouseDown, false );
		document.addEventListener('touchstart',onDocumentTouchDown, false);
		close.addEventListener( 'mousedown', function(event){
			layer.style.visibility = 'hidden';
		}, false );
		close.addEventListener('touchstart', function(event){
			layer.style.visibility = 'hidden';
		}, false);

		window.addEventListener( 'resize', onWindowResize, false );

	}

	function onWindowResize() {

		windowHalfX = window.innerWidth / 2;
		windowHalfY = window.innerHeight / 2;

		camera.aspect = window.innerWidth / window.innerHeight;
		camera.updateProjectionMatrix();

		renderer.setSize( window.innerWidth, window.innerHeight );

	}

	function onDocumentMouseDown( event ) {

		event.preventDefault();

		mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
		mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
	}

	function onDocumentTouchDown(event){
		mouse.x = ( event.touches[0].clientX / window.innerWidth ) * 2 - 1;
		mouse.y = - ( event.touches[0].clientY / window.innerHeight ) * 2 + 1;
	}
	//

	function animate() {

		requestAnimationFrame( animate );
		render();

	}

	function render() {

		// camera.position.x += ( mouseX - camera.position.x ) * .05;
		// camera.position.y += ( - mouseY - camera.position.y ) * .05;
		// if(!Obj) return;
		// Obj.rotation.y += .005;
		// find intersections

		// raycaster.setFromCamera( mouse, camera );

		// var intersects = raycaster.intersectObjects( scene.children[1].children );

		// if ( intersects.length > 0 ) {
		// 	if ( INTERSECTED != intersects[ 0 ].object ) {

		// 		if ( INTERSECTED ) INTERSECTED.material.emissive.setHex( INTERSECTED.currentHex );

		// 		INTERSECTED = intersects[ 0 ].object;
		// 		content.innerHTML = INTERSECTED.name + "被点击";
		// 		layer.style.visibility = "visible";
		// 		INTERSECTED.currentHex = INTERSECTED.material.emissive.getHex();
		// 		INTERSECTED.material.emissive.setHex( 0xff0000 );
		// 	}

		// } else {
		// 	if ( INTERSECTED ) INTERSECTED.material.emissive.setHex( INTERSECTED.currentHex );

		// 	INTERSECTED = null;

		// }

		renderer.render( scene, camera );

	}

</script>
</html>